from library.src.abstractions.client import ClientBase, ClientInfoBase
from library.src.abstractions.switcher import SwitcherBase
from library.src.log.log_manager import LogWriter
from library.src.network.http_handler import HttpConnection
from library.src.configs import ServerConfig


class ClientInfo(ClientInfoBase):
    """
    Note!! the public exponent on SDK must set to 000001\n
    because the multiple inverse of 1 is 1\n
    data^1 mod n = data\n
    enc^1 mod n = data^1^1 mod n = data\n
    I do not want let our server to compute the rsa encryption so I made this trick\n
    """

    PEER_KEY_PRIVATE = ""
    PEER_KEY_EXPONENT = "000001"
    PEER_KEY_MODULUS = "aefb5064bbd1eb632fa8d57aab1c49366ce0ee3161cbef19f2b7971b63b811790ecbf6a47b34c55f65a0766b40c261c5d69c394cd320842dd2bccba883d30eae8fdba5d03b21b09bfc600dcb30b1b2f3fbe8077630b006dcb54c4254f14891762f72e7bbfe743eb8baf65f9e8c8d11ebe46f6b59e986b4c394cfbc2c8606e29f"
    SERVER_DATA = "95980bf5011ce73f2866b995a272420c36f1e8b4ac946f0b5bfe87c9fef0811036da00cfa85e77e00af11c924d425ec06b1dd052feab1250376155272904cbf9da831b0ce3d52964424c0a426b869e2c0ad11ffa3e70496e27ea250adb707a96b3496bff190eafc0b6b9c99db75b02c2a822bb1b5b3d954e7b2c0f9b1487e3e1"
    SIGNATURE_PREFIX = "0001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF003020300C06082A864886F70D020505000410"

    PRIVATE_KEY_D = [0x96, 0xE2, 0xF4, 0xF9, 0x7C, 0x78, 0x81, 0x0C, 0x13, 0xE2, 0xA4, 0xCA, 0xC1, 0x12, 0x44, 0xBB, 0x5B, 0x37, 0xC5, 0x4E, 0x98, 0x20, 0xF1, 0x3F, 0xE9, 0xB5, 0x53, 0xDA, 0x10, 0xB1, 0xE8, 0xEF, 0x8E, 0xB0, 0x3F, 0x87, 0x68, 0x1B, 0x0E, 0x62, 0x4D, 0x1A, 0x8D, 0xE9, 0x17, 0x4C, 0xBE, 0xE5, 0xB8, 0xED, 0x92, 0xE4, 0xBE, 0x74, 0xF8, 0x6C, 0x30, 0x38, 0xCD, 0x7C, 0x1A, 0x20, 0xB9, 0xA3,
                     0xDB, 0x1D, 0x49, 0x22, 0x62, 0x87, 0x38, 0x68, 0xFB, 0xA0, 0x8E, 0x1E, 0xAB, 0x5C, 0xBA, 0x86, 0x3F, 0x8F, 0xDB, 0xF4, 0x5E, 0xEA, 0x61, 0x4B, 0xBF, 0x6C, 0xFC, 0x47, 0x00, 0x81, 0x44, 0x2A, 0x97, 0x78, 0x7E, 0xB6, 0xEC, 0xA7, 0x1C, 0x48, 0x96, 0x81, 0x6C, 0x2A, 0x62, 0x72, 0x4C, 0x0E, 0x8C, 0xAA, 0xEE, 0xAB, 0x72, 0x78, 0xC2, 0x55, 0x4A, 0x13, 0x80, 0x94, 0x6E, 0xED, 0x21, 0x29]  # fmt: skip

    MODULUES = [0xA9, 0x3E, 0x00, 0x19, 0x2C, 0x4A, 0x98, 0x69, 0xD7, 0x41, 0x9A, 0xFF, 0x66, 0x2E, 0xCA, 0xD6, 0xC8, 0xB9, 0x99, 0x09, 0xFD, 0xD0, 0xE7, 0xF8, 0xCA, 0xDD, 0x15, 0x32, 0xE8, 0xE3, 0x59, 0x37, 0x40, 0x83, 0xDA, 0xB8, 0xBE, 0x71, 0x7F, 0x60, 0x91, 0x60, 0xCD, 0x6A, 0x54, 0x11, 0xBE, 0xD7, 0x92, 0x7A, 0xD3, 0xB5, 0xC0, 0x0C, 0x4C, 0x4B, 0x34, 0x76, 0x71, 0xF2, 0x3F, 0xE0, 0x1E, 0xBB,
                0x2F, 0x83, 0x4B, 0xD8, 0xCA, 0x27, 0xC3, 0x55, 0x3E, 0x1E, 0x6B, 0xC2, 0x85, 0xAF, 0xC6, 0x3E, 0xC0, 0xE1, 0x1F, 0x59, 0xCA, 0xF6, 0xAC, 0x37, 0x5F, 0x4B, 0x0E, 0xB8, 0x2A, 0x4D, 0xA2, 0x2C, 0x0C, 0x10, 0x1D, 0x09, 0x13, 0x1A, 0x7C, 0x42, 0x0D, 0x4C, 0xC4, 0xD0, 0x95, 0x62, 0x4C, 0x42, 0xBC, 0xD8, 0xD7, 0x19, 0x16, 0xC8, 0xDC, 0x00, 0x48, 0x08, 0x6D, 0x74, 0x6A, 0x31, 0x55, 0xC7]  # fmt: skip

    EXPONENT = [0x01, 0x00, 0x01]  # fmt: skip


class Client(ClientBase):
    info: ClientInfo
    client_pool: dict[str, "Client"] = {}

    def __init__(self, connection: HttpConnection, server_config: ServerConfig, logger: LogWriter):
        super().__init__(connection, server_config, logger)
        self.info = ClientInfo()

    def on_received(self, buffer: str) -> None:
        assert isinstance(buffer, str)
        super().on_received(buffer)

    def _create_switcher(self, buffer:  str) -> SwitcherBase:
        assert isinstance(buffer, str)
        from servers.web_services.src.applications.switcher import Switcher
        return Switcher(self, buffer)
